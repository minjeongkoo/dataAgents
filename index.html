<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Distance vs RSSI</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
  <h2>Live Distance vs RSSI</h2>
  <div id="plot" style="width: 100%; height: 90vh;"></div>

  <script>
    const socket = new WebSocket('ws://' + location.host);

    let distances = [];
    let rssi = [];

    socket.onmessage = (event) => {
      const points = JSON.parse(event.data);
      points.forEach(p => {
        if (p.distance > 0 && p.distance < 20000) { // 0 ~ 20m 필터
          distances.push(p.distance);
          rssi.push(p.rssi);
        }
      });

      Plotly.newPlot('plot', [{
        x: distances,
        y: rssi,
        mode: 'markers',
        marker: { size: 5 }
      }], {
        title: 'Distance (mm) vs RSSI',
        xaxis: { title: 'Distance (mm)' },
        yaxis: { title: 'RSSI' }
      });
    };
  </script>
</body>
</html>
