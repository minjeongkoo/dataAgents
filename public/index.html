<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>multiScan100 Viewer</title>
  <script src="/socket.io/socket.io.js"></script> <!-- ✅ Socket.IO 클라이언트 스크립트 추가 -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script> <!-- ✅ Plotly.js -->
  <style>
    body { margin: 0; overflow: hidden; }
    #chart { width: 100vw; height: 100vh; }
  </style>
</head>
<body>
  <div id="chart"></div>

  <script>
    // Socket.IO 연결
    const socket = io();

    

    socket.on('lidar-points', (points) => {
      console.log('[Browser] Received points:', points.length);
      console.log('[Browser] Example point:', points[0]);

      if (points.length === 0) return;

      const x = points.map(p => p.x);
      const y = points.map(p => p.y);
      const z = points.map(p => p.z);

      const trace = {
        x,
        y,
        z,
        mode: 'markers',
        type: 'scatter3d',
        marker: {
          size: 2,
          color: z,
          colorscale: 'Jet', // ✅ z값 기준으로 컬러맵
          cmin: -10000,
          cmax: 10000,
          showscale: false
        }
      };

      const lidarOrigin = {
        x: [0],
        y: [0],
        z: [0],
        mode: 'markers',
        type: 'scatter3d',
        marker: {
          size: 5,
          color: 'black'
        }
      };

      Plotly.react('chart', [trace, lidarOrigin], {
        margin: {l: 0, r: 0, b: 0, t: 0},
        scene: {
          xaxis: {range: [-30000, 30000]},
          yaxis: {range: [-30000, 30000]},
          zaxis: {range: [-30000, 30000]},
          aspectmode: 'data' // ✅ x,y,z 비율 고정
        }
      });
    });
  </script>
</body>
</html>
